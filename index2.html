<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Stylish Portfolio - Start Bootstrap Template</title>

  <!-- Bootstrap Core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="css/stylish-portfolio.min.css" rel="stylesheet">
  
   <!-- Include Dexie -->
      <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>  
    <style>
        .listTemplate{display:none;}
        .Completed {color:red;}
        .Open {color: green;}
    </style>
</head>

<body id="page-top">

  <!-- Navigation -->
  <a class="menu-toggle rounded" href="#">
    <i class="fas fa-bars"></i>
  </a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand">
        <a class="js-scroll-trigger nav-main" href="#header">Graffiti Removal</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger nav-link" href="#search">Search</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger nav-link" href="#list">List</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger nav-link" href="#map1">Map</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger nav-about" href="#about">About</a>
      </li>
    </ul>
  </nav>

  <!-- Header -->
  <section class="content-section bg-primary " id="header">
    <div class="container text-center my-auto">
      <h1 class="mb-1">Graffiti Removal Request</h1>
      <h3 class="mb-5">
        <em>A Progressive Web App to search through Graffiti Removal Requests</em>
      </h3>
    </div>
    <div class="overlay"></div>
  </section>

  <!-- About -->
    
  <section class="content-section bg-primary " id="about">
    <div class="container text-center my-auto">
      <h1 class="mb-1">Graffiti Removal App</h1>
      <h3 class="mb-5">
        <em>Developer: Rime Brika</em>
      </h3>
      <h3 class="mb-5">
        <em><a href="https://rbrika.github.io/it202-project2/">GitHub Repo</a></em>
      </h3>
    </div>
      
    <div class="overlay"></div>
  </section>  
    
  <!-- Call to Action -->
  <section class="content-section bg-primary text-white" id="search">
    <div class="container text-center">
      <h2 class="mb-4">You can search for graffiti removal request by inserting a ward and status</h2>
        <form>
          <div class="form-group">
              <label>Ward</label>
                <input class="form-control" id="ward" placeholder="Enter a Ward number">
          </div>
          <div class="form-group">
              <label for="sel1">Status List:</label>
              <select class="form-control" id="status">
                  <option value="">Select a status</option>
                  <option value="Open">Open</option>
                  <option value="Completed">Completed</option>
              </select>
          </div>  
          <a href="#" class="btn btn-xl btn-dark" id="searchButton">Search</a>
        </form>
    </div>
  </section>

  <!-- List -->
  <section class="content-section bg-primary text-white text-center" id="list">
    <div class="container">
      <div class="content-section-heading">
        <h3 class="text-secondary mb-0" style="font-size:50px;">List</h3>
        <p id="show" class="mb-5" style="font-size:42px;"></p>
      </div>
      <div class="row" id="cardsList">
      </div>
    </div>
  </section>
    <div id="cardList"class="card listTemplate col-lg-3 col-md-6 mb-5 mb-lg-0"  data-id="">
		<div class="card-bodyList">
			<h3 class="card-address mb-2 ">Card title</h3>
			<h5 class="card-date mb-2 text-muted">Card date</h5>
            <h6 class="card-request mb-2 text-muted">Card date</h6>
            <h6 class="card-location mb-2 text-muted">Card date</h6>
            <h6 class="card-surface mb-2 text-muted">Card date</h6>
            <h6 class="card-status mb-2 text-muted">Card date</h6>
            <h6 class="card-dateComplete mb-2 text-muted">Card date</h6>
		</div>
	</div>
  <!-- Map -->
  <section id="map1" class="map"></section>

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <ul class="list-inline mb-5">
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-facebook"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-twitter"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white" href="#">
            <i class="icon-social-github"></i>
          </a>
        </li>
      </ul>
      <p class="text-muted small mb-0">Copyright &copy; Rime Brika Project 2 2019</p>
    </div>
  </footer>

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded js-scroll-trigger" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/stylish-portfolio.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      

    <script>
      $(document).ready(function() {
          
          $("#map1").css("display", "none");
             $("#search").css("display", "none");
             $("#list").css("display", "none");
          $("#about").css("display", "none");
         var endpoint = "https://data.cityofchicago.org/resource/cdmx-wzbz.json?";
          
          var db = new Dexie("graffiti_database");
          db.version(1).stores({
              graffiti: '++id,address,date,request,location,statusDB,surface,dateComplete,lat,long'
          });
          db.graffiti.clear();
            function loadCards(){
                
                db.graffiti.each(function(v){
                    var clone = $(".listTemplate").clone();
                     clone.find(".card-address").text(v.address);
                     clone.find(".card-date").text("Date Created: "+v.date); 
                     clone.find(".card-request").text("Service Request Number: "+v.request); 
                     clone.find(".card-location").text("Where the Graffiti is located: "+v.location); 
                     clone.find(".card-status").text("Status: "+v.statusDB); 
                     clone.find(".card-surface").text("What type of surface?: "+v.surface); 
                     clone.find(".card-dateComplete").text("Completion Date: "+v.dateComplete);
                     clone.attr("data-id",v.id);
                     clone.addClass(v.statusDB);
                     clone.removeClass("listTemplate");
                     $("#cardsList").append(clone);
                   
                });
                                   
          }
          function addMarkers(){
              var chicago = {lat: 41.8781, lng: -87.6298};
              var map = new google.maps.Map(document.getElementById('map1'), {zoom: 12, center: chicago});
              db.graffiti.each(function(v){
                  var infowindow = new google.maps.InfoWindow({
                         content:
                          '<div id="content">'+
                              '<div id="siteNotice">'+
                              '</div>'+
                               '<h1 id="firstHeading" class="firstHeading">' 
                                +v.address+ 
                                '</h1>'+
                                '<div id="bodyContent">'+
                                '<b>Date Created: '+v.date+'<br>Completion Date:'+v.dateComplete+
                                '</b><br><br><b>Where the Graffiti is located: '+v.location+'</b><br><br><b>What type of surface?: '+v.surface+'</b>'+
                                '<br><br><b>Status: '+v.statusDB+'</b><br><br><b>Service Request Number: '+v.request+'</b>'+
                                '</div>'+
                          '</div>'
                  });
                  
                  var iconColor;
                  var location = {lat: v.lat, lng: v.long};
                  if(v.statusDB=="Open"){
                         iconColor="grn-circle.png";
                     }
                     else{
                         iconColor="red-circle.png";
                     }
                         var marker = new google.maps.Marker({
                             position: location, 
                             map: map,
                             icon: iconColor
                         });
                         marker.set("id",v.id);
                         marker.addListener('click', function() {
                             var idM=marker.get("id");
                             console.log("clicked on marker "+idM);
                             infowindow.open(map, marker);
                         });
              });
          }
         
         $(".nav-link").on("click", function(){
             hideScreens();
             console.log("clicked on nav content");
             var target = $(this).attr("href");
             $(target).css("display", "block");
             if(target=="#list"){
                //loadCards();
                }
             if(target=="#map1"){
                 console.log("Clicked on map");
                 //addMarkers();
                }
         });
          
          $(".nav-about").on("click",function(){
             hideScreens();
             $("#about").css("display", "block");
         });
         $(".nav-main").on("click",function(){
             db.graffiti.clear();
             $("#cardsList").empty();
             $("#map1").empty();
             document.getElementById("show").innerHTML = "Showing 0 results:";
             hideScreens();
             console.log("clicked on Nav MEnu");
             $("#header").css("display", "block");
         });
         function hideScreens() {
             console.log("Hiding Screens");
             $("#map1").css("display", "none");
             $("#search").css("display", "none");
             $("#list").css("display", "none");
             $("#header").css("display", "none");
             $("#about").css("display", "none");
             
         }
         $("#searchButton").on("click", function(){
             db.graffiti.clear();
             $("#cardsList").empty();
             $("#map1").empty();  
             var ward=$("#ward").val();
             var status=$("#status").val();
             var url=endpoint;
             if(ward!=""){
                 url=url+"&ward="+ward;
             }
             if(status!=""){
                 url=url+"&status="+status;
             }
             console.log(url);
             $.get(url,function(response){
                 var data = response;
                 document.getElementById("show").innerHTML = "Showing "+response.length+" results:";
                 $.each(data, function(i,v){
                     var completeDate;
                     if(v.completion_date==null){
                        completeDate="N/A"
                        }
                     else{
                         completeDate=v.completion_date.split("T")[0];
                     }
                     db.graffiti.put({
                         address:v.street_address,
                         date:v.creation_date.split("T")[0],
                         request:v.service_request_number,
                         location:v.where_is_the_graffiti_located_,
                         statusDB:v.status,
                         surface:v.what_type_of_surface_is_the_graffiti_on_,
                         dateComplete:completeDate,
                         lat:parseFloat(v.latitude),
                         long:parseFloat(v.longitude)
                     });                     
                 });  
                 loadCards();
                 addMarkers();
             });
         });
      });
        // register the service worker for offline use
        if('serviceWorker' in navigator) {
          navigator.serviceWorker
                   .register('./sw.js')
                   .then(function() { 
                          console.log("Service Worker Registered");   
                   });
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyCODaRYxz2gS1fniGC3JVDYQPh2ORVkXXU">
    </script>
</body>
</html>
